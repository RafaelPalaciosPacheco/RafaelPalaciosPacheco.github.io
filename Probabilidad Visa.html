<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Probabilidad de Visa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #00205b;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 8px; /* Espacio entre el texto y el ícono */
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #374151; /* gray-700 */
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            font-weight: 400;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #374151 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        /* Estilo personalizado para el dropdown */
        .custom-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236B7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 3rem; /* p-3 es 0.75rem, necesitamos más espacio para la flecha */
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Custom Alert Modal -->
    <div id="customAlert" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm w-full">
            <p id="customAlertMessage" class="text-lg mb-6 text-gray-700"></p>
            <button id="closeAlert" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-8 rounded-lg transition-colors">Cerrar</button>
        </div>
    </div>

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-10">
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-blue-900">🇺🇸 Calculadora de Probabilidad de Visa</h1>
                <p class="text-gray-600 mt-2">Estima tus posibilidades y prepárate para tu entrevista. Responde con honestidad.</p>
            </header>

            <form id="visaForm" class="space-y-6">
                <!-- Pregunta 1: Motivo del viaje -->
                <div>
                    <label for="purpose" class="block text-lg font-semibold mb-2 flex items-center">
                        <span>¿Para qué quieres ir a los Estados Unidos?</span>
                        <div class="tooltip">
                            <svg class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="tooltiptext">El oficial consular quiere saber si tu motivo es creíble y si corresponde a una visa de no-inmigrante. El turismo y los negocios son motivos sólidos.</span>
                        </div>
                    </label>
                    <select id="purpose" name="purpose" class="custom-select w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        <option value="" disabled selected>Elige una respuesta</option>
                        <option value="tourism">Turismo / Vacaciones</option>
                        <option value="business">Negocios / Conferencia</option>
                        <option value="family">Visitar Familiares</option>
                        <option value="studies">Estudios</option>
                    </select>
                </div>

                <!-- Pregunta 2: Ocupación -->
                <div>
                    <label for="occupation" class="block text-lg font-semibold mb-2 flex items-center">
                        <span>¿A qué te dedicas?</span>
                        <div class="tooltip">
                            <svg class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="tooltiptext">Tener un trabajo estable, ser estudiante o dueño de un negocio son fuertes lazos de arraigo a tu país, lo que reduce la sospecha de que quieras quedarte en EE.UU.</span>
                        </div>
                    </label>
                    <select id="occupation" name="occupation" class="custom-select w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        <option value="" disabled selected>Elige una respuesta</option>
                        <option value="employed">Empleado</option>
                        <option value="student">Estudiante</option>
                        <option value="business_owner">Dueño de Negocio</option>
                        <option value="unemployed">Desempleado</option>
                        <option value="retired">Jubilado / Pensionado</option>
                    </select>
                </div>

                <!-- Pregunta 3: Antigüedad (Condicional) -->
                <div id="timeInJobContainer" class="hidden">
                     <label for="timeInJob" class="block text-lg font-semibold mb-2 flex items-center">
                        <span>¿Cuánto tiempo tienes en tu trabajo o escuela?</span>
                        <div class="tooltip">
                            <svg class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="tooltiptext">La antigüedad demuestra estabilidad. Un largo historial en un mismo lugar es una señal muy positiva de que no tienes intención de abandonar tu vida actual.</span>
                        </div>
                    </label>
                    <select id="timeInJob" name="timeInJob" class="custom-select w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        <option value="" disabled selected>Elige una respuesta</option>
                        <option value="less_6m">Menos de 6 meses</option>
                        <option value="6m_1y">6 meses a 1 año</option>
                        <option value="1y_3y">1 a 3 años</option>
                        <option value="3y_5y">3 a 5 años</option>
                        <option value="more_5y">Más de 5 años</option>
                    </select>
                </div>
                
                <!-- Pregunta 4: Salario -->
                <div>
                    <label for="salary" class="block text-lg font-semibold mb-2 flex items-center">
                        <span>¿Cuál es tu salario mensual (aprox. en MXN)?</span>
                         <div class="tooltip">
                            <svg class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="tooltiptext">Un ingreso estable y suficiente demuestra que puedes costear tu viaje sin necesidad de trabajar ilegalmente, y que tienes una razón económica para regresar a tu país.</span>
                        </div>
                    </label>
                    <select id="salary" name="salary" class="custom-select w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        <option value="" disabled selected>Elige una respuesta</option>
                        <option value="none">No tengo ingresos</option>
                        <option value="low">Menos de $10,000</option>
                        <option value="medium">$10,000 - $25,000</option>
                        <option value="high">$25,001 - $50,000</option>
                        <option value="very_high">Más de $50,000</option>
                    </select>
                </div>

                <!-- Pregunta 5: Con quién vives -->
                <div>
                    <label for="living" class="block text-lg font-semibold mb-2 flex items-center">
                        <span>¿Con quién vives?</span>
                        <div class="tooltip">
                            <svg class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="tooltiptext">Vivir con familia, especialmente cónyuge e hijos, representa un lazo familiar muy fuerte que te ata a tu país de origen. Es un factor muy positivo.</span>
                        </div>
                    </label>
                    <select id="living" name="living" class="custom-select w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        <option value="" disabled selected>Elige una respuesta</option>
                        <option value="alone">Solo / Independiente</option>
                        <option value="parents">Con mis padres</option>
                        <option value="partner">Con mi pareja / cónyuge</option>
                        <option value="family_kids">Con mi pareja e hijos</option>
                        <option value="roommates">Con otros familiares / roomies</option>
                    </select>
                </div>
                
                <!-- Pregunta 6: Familiares en EU -->
                <div>
                    <label for="relatives" class="block text-lg font-semibold mb-2 flex items-center">
                        <span>¿Tienes familiares directos en EE.UU.?</span>
                        <div class="tooltip">
                           <svg class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="tooltiptext">Esta pregunta evalúa posibles intenciones de inmigración. No tener familiares es lo ideal. Tener familiares sin estatus legal es una bandera roja importante.</span>
                        </div>
                    </label>
                    <select id="relatives" name="relatives" class="custom-select w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        <option value="" disabled selected>Elige una respuesta</option>
                        <option value="no">No</option>
                        <option value="yes_legal">Sí, con estatus legal</option>
                        <option value="yes_illegal">Sí, sin estatus legal definido</option>
                    </select>
                </div>

                <!-- Pregunta 7: Viajes previos -->
                <div>
                     <label for="travelHistory" class="block text-lg font-semibold mb-2 flex items-center">
                        <span>¿Has viajado a otros países?</span>
                        <div class="tooltip">
                            <svg class="w-6 h-6 text-gray-500 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="tooltiptext">Un historial de viajes internacionales (y regresos a tu país) es una de las pruebas más contundentes de que eres un turista genuino y no un inmigrante en potencia.</span>
                        </div>
                    </label>
                    <select id="travelHistory" name="travelHistory" class="custom-select w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        <option value="" disabled selected>Elige una respuesta</option>
                        <option value="none">No, nunca he salido de mi país</option>
                        <option value="few">Sí, a 1 o 2 países</option>
                        <option value="many">Sí, a más de 2 países</option>
                    </select>
                </div>

                <!-- Botón de Calcular -->
                <div class="pt-4 text-center">
                    <button type="submit" class="bg-red-700 hover:bg-red-800 text-white font-bold py-3 px-10 rounded-lg text-xl transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-300">
                        Calcular Probabilidad
                    </button>
                </div>
            </form>

            <!-- Sección de Resultados -->
            <div id="results" class="hidden mt-12">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Tu Análisis de Perfil</h2>
                
                <div class="mb-8">
                    <div class="flex justify-between mb-1">
                        <span class="text-base font-medium text-blue-700">Probabilidad de Aprobación</span>
                        <span id="probabilityText" class="text-sm font-medium text-blue-700"></span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-6">
                        <div id="progressBar" class="bg-gradient-to-r from-green-400 to-blue-500 h-6 rounded-full text-center text-white font-bold flex items-center justify-center transition-all duration-1000 ease-out" style="width: 0%"></div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
                        <h3 class="text-2xl font-semibold text-green-800 mb-4">✅ Puntos Fuertes</h3>
                        <ul id="strongPoints" class="list-disc list-inside space-y-2 text-green-900"></ul>
                    </div>
                    <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg">
                        <h3 class="text-2xl font-semibold text-red-800 mb-4">⚠️ Puntos Débiles y Mejoras</h3>
                        <ul id="weakPoints" class="list-disc list-inside space-y-2 text-red-900"></ul>
                    </div>
                </div>

                <div class="mt-10 bg-indigo-50 border-t-4 border-indigo-500 p-6 rounded-lg">
                    <h3 class="text-2xl font-semibold text-indigo-800 mb-4">💡 Sugerencias para tu Entrevista</h3>
                    <p id="interviewTips" class="text-indigo-900 leading-relaxed"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Lógica de la Aplicación ---

        // Referencias a elementos del DOM
        const form = document.getElementById('visaForm');
        const occupationSelect = document.getElementById('occupation');
        const timeInJobContainer = document.getElementById('timeInJobContainer');
        const timeInJobSelect = document.getElementById('timeInJob');
        const resultsSection = document.getElementById('results');
        const progressBar = document.getElementById('progressBar');
        const probabilityText = document.getElementById('probabilityText');
        const strongPointsList = document.getElementById('strongPoints');
        const weakPointsList = document.getElementById('weakPoints');
        const interviewTipsParagraph = document.getElementById('interviewTips');
        
        // Modal de alerta personalizado
        const customAlert = document.getElementById('customAlert');
        const customAlertMessage = document.getElementById('customAlertMessage');
        const closeAlertButton = document.getElementById('closeAlert');

        function showCustomAlert(message) {
            customAlertMessage.textContent = message;
            customAlert.classList.remove('hidden');
        }

        closeAlertButton.addEventListener('click', () => {
            customAlert.classList.add('hidden');
        });

        // Lógica para mostrar/ocultar la pregunta condicional
        function toggleTimeInJobField() {
            const selectedOccupation = occupationSelect.value;
            if (selectedOccupation && selectedOccupation !== 'unemployed') {
                timeInJobContainer.classList.remove('hidden');
                timeInJobSelect.required = true;
            } else {
                timeInJobContainer.classList.add('hidden');
                timeInJobSelect.required = false;
            }
        }
        
        toggleTimeInJobField();
        occupationSelect.addEventListener('change', toggleTimeInJobField);

        const scores = {
            purpose: { tourism: 10, business: 10, family: 6, studies: 8 },
            occupation: { employed: 10, student: 8, business_owner: 10, unemployed: 0, retired: 6 },
            timeInJob: { less_6m: 2, '6m_1y': 4, '1y_3y': 7, '3y_5y': 9, more_5y: 10 },
            salary: { none: 0, low: 2, medium: 6, high: 8, very_high: 10 },
            living: { alone: 4, parents: 6, partner: 8, family_kids: 10, roommates: 3 },
            relatives: { no: 10, yes_legal: 4, yes_illegal: 0 },
            travelHistory: { none: 0, few: 6, many: 10 }
        };

        const feedback = {
            strong: {
                purpose: "Tu motivo de viaje (turismo/negocios) es claro y apropiado para una visa de no-inmigrante.",
                occupation: "Tener una ocupación estable como empleado, estudiante o dueño de negocio es un excelente lazo de arraigo.",
                timeInJob: "Tu antigüedad laboral/estudiantil demuestra estabilidad y compromiso, un factor muy positivo.",
                salary: "Tus ingresos son sólidos, lo que demuestra solvencia económica para costear tu viaje.",
                living: "Tu situación familiar (vivir con pareja/hijos) es un fuerte anclaje a tu país.",
                relatives: "No tener familiares directos en EE.UU. simplifica tu caso y reduce sospechas de inmigración.",
                travelHistory: "Tu historial de viajes previos es una prueba contundente de que eres un turista genuino."
            },
            weak: {
                occupation: "Estar desempleado es una bandera roja importante. Considera cómo puedes demostrar otros lazos fuertes (propiedades, familia, etc.).",
                timeInJob: "Poca antigüedad en tu trabajo/escuela puede ser visto como falta de estabilidad. Prepara documentos que prueben tus lazos.",
                salary: "Ingresos bajos o nulos generan dudas sobre cómo costearás tu viaje. Es crucial llevar estados de cuenta sólidos o una carta de patrocinio.",
                living: "Una situación de vivienda menos estable puede ser un punto débil. Enfatiza otros lazos como los familiares o laborales.",
                relatives: "Tener familiares en EE.UU., especialmente sin estatus legal, es un punto muy delicado. Debes ser honesto y prepararte para preguntas detalladas.",
                travelHistory: "La falta de historial de viajes es un punto débil. Si es posible, viajar a otro país antes de tu cita puede ayudar enormemente."
            }
        };

        form.addEventListener('submit', function(event) {
            event.preventDefault();

            // Validación
            if (!form.checkValidity()) {
                showCustomAlert("Por favor, responde todas las preguntas para poder calcular tu resultado.");
                return;
            }

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            let totalScore = 0;
            let maxScore = 0;
            const strongPoints = [];
            const weakPoints = [];
            const suggestions = [];

            // --- Lógica de cálculo (sin cambios) ---
            totalScore += scores.purpose[data.purpose];
            maxScore += 10;
            if (scores.purpose[data.purpose] > 7) { strongPoints.push(feedback.strong.purpose); suggestions.push("menciona claramente que tu intención es hacer turismo o atender asuntos de negocios, ya que es un motivo sólido."); }

            const occupationScore = scores.occupation[data.occupation];
            totalScore += occupationScore;
            maxScore += 10;
            if (occupationScore > 7) { strongPoints.push(feedback.strong.occupation); suggestions.push(`enfatiza tu estabilidad como ${data.occupation.replace('_', ' de ')}.`); } 
            else if (occupationScore < 2) { weakPoints.push(feedback.weak.occupation); }

            if (data.occupation !== 'unemployed') {
                const timeScore = scores.timeInJob[data.timeInJob];
                totalScore += timeScore;
                maxScore += 10;
                if (timeScore > 7) { strongPoints.push(feedback.strong.timeInJob); suggestions.push(`destaca tu antigüedad de ${data.timeInJob.replace('_', ' a ').replace('y',' años').replace('m',' meses')} en tu puesto.`); } 
                else if (timeScore < 4) { weakPoints.push(feedback.weak.timeInJob); }
            }

            const salaryScore = scores.salary[data.salary];
            totalScore += salaryScore;
            maxScore += 10;
            if (salaryScore > 7) { strongPoints.push(feedback.strong.salary); suggestions.push("menciona que tienes la solvencia económica para cubrir todos tus gastos."); } 
            else if (salaryScore < 3) { weakPoints.push(feedback.weak.salary); }

            const livingScore = scores.living[data.living];
            totalScore += livingScore;
            maxScore += 10;
            if (livingScore > 7) { strongPoints.push(feedback.strong.living); suggestions.push("habla de tus responsabilidades y lazos familiares en tu país."); } 
            else if (livingScore < 4) { weakPoints.push(feedback.weak.living); }

            const relativesScore = scores.relatives[data.relatives];
            totalScore += relativesScore;
            maxScore += 10;
            if (relativesScore > 8) { strongPoints.push(feedback.strong.relatives); } 
            else { weakPoints.push(feedback.weak.relatives); }

            const travelScore = scores.travelHistory[data.travelHistory];
            totalScore += travelScore;
            maxScore += 10;
            if (travelScore > 7) { strongPoints.push(feedback.strong.travelHistory); suggestions.push("no dudes en mencionar tus viajes anteriores como prueba de que siempre regresas a casa."); } 
            else if (travelScore < 2) { weakPoints.push(feedback.weak.travelHistory); }
            
            const probability = Math.min(98, Math.round((totalScore / maxScore) * 100));

            updateUI(probability, strongPoints, weakPoints, suggestions);
        });

        function updateUI(probability, strong, weak, suggestions) {
            progressBar.style.width = `${probability}%`;
            progressBar.textContent = `${probability}%`;
            probabilityText.textContent = `${probability}%`;

            strongPointsList.innerHTML = strong.length > 0 ? strong.map(p => `<li>${p}</li>`).join('') : '<li>No se identificaron puntos fuertes claros. Es importante reforzar tu perfil.</li>';
            weakPointsList.innerHTML = weak.length > 0 ? weak.map(p => `<li>${p}</li>`).join('') : '<li>¡Felicidades! Tu perfil parece muy sólido y no presenta debilidades evidentes.</li>';
            
            if (suggestions.length > 0) {
                let tipText = "Basado en tus fortalezas, cuando hables con el oficial consular, enfócate en comunicar lo siguiente: ";
                tipText += suggestions.join(' Además, ');
                tipText += " Sé claro, conciso y, sobre todo, di siempre la verdad. ¡Mucha suerte!";
                interviewTipsParagraph.textContent = tipText;
            } else {
                 interviewTipsParagraph.textContent = "Tu perfil tiene varias áreas de oportunidad. Antes de tu entrevista, enfócate en fortalecer tus lazos con tu país. Reúne toda la documentación posible que demuestre tu estabilidad laboral, económica y familiar. La clave es demostrar que tienes muchas razones para regresar a casa después de tu viaje.";
            }

            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    </script>
</body>
</html>
